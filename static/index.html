<!DOCTYPE html>
<html>
<head>
  <title>Vix75 Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    canvas { max-width: 100%; }
    .signal-box { margin-top: 10px; font-family: monospace; }
  </style>
</head>
<body>
  <canvas id="lineChart"></canvas>
  <div class="signal-box" id="signalBox"></div>

  <script>
    const ctx = document.getElementById('lineChart').getContext('2d');
    const data = { labels: [], datasets: [{ label: 'Vix75', data: [], borderColor: 'blue', tension: 0.2 }] };
    const config = { type: 'line', data: data, options: { responsive: true } };
    const chart = new Chart(ctx, config);

    const signalBox = document.getElementById('signalBox');
    const ws = new WebSocket("ws://localhost:8000/ws");

    ws.onmessage = (event) => {
      const msg = JSON.parse(event.data);

      if (msg.ticks) {
        const times = msg.ticks.map(t => new Date(t.time).toLocaleTimeString());
        const prices = msg.ticks.map(t => t.price);
        chart.data.labels = times;
        chart.data.datasets[0].data = prices;
        chart.update();
      }

      if (msg.signal) {
        const s = msg.signal;
        signalBox.innerHTML = `
          <b>Signal Detected</b><br>
          Entry: ${s.entry} | TP: ${s.tp} | SL: ${s.sl} | Time: ${new Date(s.time).toLocaleTimeString()}
        `;

        // Optional: Add signal marker
        chart.data.datasets.push({
          label: 'Signal',
          data: Array(chart.data.labels.length - 1).fill(null).concat(s.entry),
          borderColor: 'green',
          borderWidth: 2,
          pointRadius: 5,
          pointBackgroundColor: 'green',
          type: 'line',
          fill: false,
          showLine: false
        });
        chart.update();
      }
    };
  </script>
</body>
</html>
